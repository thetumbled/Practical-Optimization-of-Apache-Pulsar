# 1. UniformLoadShedder + LeastLongTermMessageRate

## 1.1 **Environment Configuration**

A pulsar cluster was built with 4 brokers and 20 bookies. However, one machine, `XXX.34`, is heterogeneous and significantly more powerful than the other three machines.

&#x20;

The load balancing-related configurations are as follows:

```
loadBalancerLoadSheddingStrategy=org.apache.pulsar.broker.loadbalance.impl.UniformLoadShedder
loadBalancerLoadPlacementStrategy=org.apache.pulsar.broker.loadbalance.impl.LeastLongTermMessageRate
```

Using the combination of `UniformLoadShedder` and `LeastLongTermMessageRate`, most of the configuration is set to default values. For instance, the [maximum message rate](../chapter-2-load-balancing-algorithm-principles-and-analysis-load-shedding-strategy/3.-uniformloadshedder.md#id-3.1-highest-and-lowest-loaded-brokers) can be up to 1.5 times the minimum message rate, while the [maximum throughput](../chapter-2-load-balancing-algorithm-principles-and-analysis-load-shedding-strategy/3.-uniformloadshedder.md#id-3.1-highest-and-lowest-loaded-brokers) can reach up to 4 times the minimum throughput.

Note: No evidence exists to indicate that, within the default settings, the throughput ratio threshold ought to be greater than the message rate ratio threshold. It is advisable for users to adjust these two thresholds according to actual scenarios.

&#x20;

The feature of `bundle split` and `uniform distribution of bundles` has been disabled:

```
loadBalancerDistributeBundlesEvenlyEnabled=false
loadBalancerAutoBundleSplitEnabled=false
loadBalancerAutoUnloadSplitBundlesEnabled=false
```

**It is strongly recommended to disable the bundle even distribution feature!** This feature can render the load-balancing algorithm nearly ineffective. The reason is that it enforces the number of bundles across different brokers to be equivalent. When filtering candidate brokers, it will exclude the majority of brokers, the result of which will be fed into the load - balancing algorithm. In small clusters, the input of load-balancing algorithm usually contains one single broker. As a result, the load - balancing algorithm becomes nearly ineffective.

&#x20;

## **1.2 Heterogeneous Environment**

Two pressure testing tasks were launched:







