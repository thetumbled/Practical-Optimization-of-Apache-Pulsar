# 1. 介绍



## **1.1 bundle**

Pulsar的负载单元称为bundle，bundle可以理解为topic的容器，一个bundle能够包含多个topic，并且通过一致性哈希算法将topic名称映射至相应的bundle。

bundle是Pulsar支持百万topic分区的关键，它能将Pulsar对Zookeeper的压力降低几个数量级。

首先，每个broker对topic分区的所有权关系是通过在Zookeeper上面的一个临时节点来表示的，broker尝试获取topic的所有权时，就会在Zookeeper上面创建对应的临时节点，当broker下线时临时节点会自动删除，从而释放掉所有权。

如果不引入bundle，则每个topic分区都需要在Zookeeper上面对应一个临时节点，但是Zookeeper的QPS上限只有几万，而且不支持横向拓展，从而限制Pulsar的topic上限为只有几万。

引入bundle概念，只需要在Zookeeper上面建立bundle对应的临时节点，，每个bundle能容纳几十上百个分区，从而能将Zookeeper的压力降低几个数量级，支持百万级别的topic分区。



## **1.2 卸载策略与放置策略**

所谓负载均衡其实很简单，大致分为两个步骤：

1\. 将bundle从高载的brokerA身上卸载

2\. 将卸载下来的bundle分配给低载的brokerB



分别对应了Pulsar的两个接口：

1\. LoadSheddingStrategy 是卸载策略，负责识别高负载的broker，并将其承载的部分bundle unload下来，以降低负载。

2\. ModularLoadManagerStrategy 是放置策略，负责将bundle分配给低载broker。

&#x20;

LoadSheddingStrategy 策略旨在卸载高负载的broker bundle，然而，为了确保集群负载均衡模块的高效运行，不仅需要正确地 “卸载” ，还必须恰当地 “放置” bundle。这两者是相辅相成的，它们之间的协调配合是至关重要的。在后续章节中，我们将深入探讨这一关键点。

另外，Pulsar还支持多种负载均衡器，默认使用的是ModularLoadManagerImpl，这篇文章也基于使用ModularLoadManagerImpl负载均衡器来展开。负载均衡器的作用包括搜集上报负载数据、执行卸载策略和放置策略等，一个良好的均衡效果离不开准确及时的负载数据信息，这里就先不展开了。

&#x20;





